(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function l(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(o){if(o.ep)return;o.ep=!0;const c=l(o);fetch(o.href,c)}})();var r,i={videoTrack:null,audioTrack:null},p={},t={appid:null,channel:null,uid:null,token:null},u=[{label:"360p_7",detail:"480×360, 15fps, 320Kbps",value:"360p_7"},{label:"360p_8",detail:"480×360, 30fps, 490Kbps",value:"360p_8"},{label:"480p_1",detail:"640×480, 15fps, 500Kbps",value:"480p_1"},{label:"480p_2",detail:"640×480, 30fps, 1000Kbps",value:"480p_2"},{label:"720p_1",detail:"1280×720, 15fps, 1130Kbps",value:"720p_1"},{label:"720p_2",detail:"1280×720, 30fps, 2000Kbps",value:"720p_2"},{label:"1080p_1",detail:"1920×1080, 15fps, 2080Kbps",value:"1080p_1"},{label:"1080p_2",detail:"1920×1080, 30fps, 3000Kbps",value:"1080p_2"}],n;AgoraRTC.onAutoplayFailed=()=>{alert("click to start autoplay!")};AgoraRTC.onMicrophoneChanged=async e=>{if(e.state==="ACTIVE")i.audioTrack.setDevice(e.device.deviceId);else if(e.device.label===i.audioTrack.getTrackLabel()){const a=await AgoraRTC.getMicrophones();a[0]&&i.audioTrack.setDevice(a[0].deviceId)}};AgoraRTC.onCameraChanged=async e=>{if(e.state==="ACTIVE")i.videoTrack.setDevice(e.device.deviceId);else if(e.device.label===i.videoTrack.getTrackLabel()){const a=await AgoraRTC.getCameras();a[0]&&i.videoTrack.setDevice(a[0].deviceId)}};async function f(){i.audioTrack||(i.audioTrack=await AgoraRTC.createMicrophoneAudioTrack({encoderConfig:"music_standard"})),i.videoTrack||(i.videoTrack=await AgoraRTC.createCameraVideoTrack({encoderConfig:n.value})),mics=await AgoraRTC.getMicrophones();const e=i.audioTrack.getTrackLabel();currentMic=mics.find(l=>l.label===e),$(".mic-input").val(currentMic.label),$(".mic-list").empty(),mics.forEach(l=>{$(".mic-list").append(`<a class="dropdown-item" href="#">${l.label}</a>`)}),cams=await AgoraRTC.getCameras();const a=i.videoTrack.getTrackLabel();currentCam=cams.find(l=>l.label===a),$(".cam-input").val(currentCam.label),$(".cam-list").empty(),cams.forEach(l=>{$(".cam-list").append(`<a class="dropdown-item" href="#">${l.label}</a>`)})}async function v(e){currentCam=cams.find(a=>a.label===e),$(".cam-input").val(currentCam.label),await i.videoTrack.setDevice(currentCam.deviceId)}async function m(e){currentMic=mics.find(a=>a.label===e),$(".mic-input").val(currentMic.label),await i.audioTrack.setDevice(currentMic.deviceId)}function b(){u.forEach(e=>{$(".profile-list").append(`<a class="dropdown-item" label="${e.label}" href="#">${e.label}: ${e.detail}</a>`)}),n=u.find(e=>e.label=="480p_1"),$(".profile-input").val(`${n.detail}`)}async function k(e){n=u.find(a=>a.label===e),$(".profile-input").val(`${n.detail}`),i.videoTrack&&await i.videoTrack.setEncoderConfiguration(n.value)}$(()=>{b(),$(".profile-list").delegate("a","click",function(a){k(this.getAttribute("label"))});var e=new URL(location.href).searchParams;t.appid=e.get("appid"),t.channel=e.get("channel"),t.token=e.get("token"),t.uid=e.get("uid"),t.appid&&t.channel&&($("#uid").val(t.uid),$("#appid").val(t.appid),$("#token").val(t.token),$("#channel").val(t.channel),$("#join-form").submit())});$("#join-form").submit(async function(e){e.preventDefault(),$("#join").attr("disabled",!0);try{r||(r=AgoraRTC.createClient({mode:"rtc",codec:w()})),t.channel=$("#channel").val(),t.uid=Number($("#uid").val()),t.appid=$("#appid").val(),t.token=$("#token").val(),await h(),t.token?$("#success-alert-with-token").css("display","block"):($("#success-alert a").attr("href",`index.html?appid=${t.appid}&channel=${t.channel}&token=${t.token}`),$("#success-alert").css("display","block"))}catch(a){console.error(a)}finally{$("#leave").attr("disabled",!1)}});$("#leave").click(function(e){T()});$("#agora-collapse").on("show.bs.collapse	",function(){f()});$(".cam-list").delegate("a","click",function(e){v(this.text)});$(".mic-list").delegate("a","click",function(e){m(this.text)});async function h(){r.on("user-published",y),r.on("user-unpublished",C),r.join(t.appid,t.channel,t.token||null,t.uid||null),i.audioTrack||(i.audioTrack=await AgoraRTC.createMicrophoneAudioTrack({encoderConfig:"music_standard"})),i.videoTrack||(i.videoTrack=await AgoraRTC.createCameraVideoTrack({encoderConfig:n.value})),i.videoTrack.play("local-player"),$("#local-player-name").text(`localVideo(${t.uid})`),$("#joined-setup").css("display","flex"),await r.publish(Object.values(i)),console.log("publish success")}async function T(){for(trackName in i){var e=i[trackName];e&&(e.stop(),e.close(),i[trackName]=void 0)}p={},$("#remote-playerlist").html(""),await r.leave(),$("#local-player-name").text(""),$("#join").attr("disabled",!1),$("#leave").attr("disabled",!0),$("#joined-setup").css("display","none"),console.log("client leaves channel success")}async function g(e,a){const l=e.uid;if(await r.subscribe(e,a),console.log("subscribe success"),a==="video"){const s=$(`
      <div id="player-wrapper-${l}">
        <p class="player-name">remoteUser(${l})</p>
        <div id="player-${l}" class="player"></div>
      </div>
    `);$("#remote-playerlist").append(s),e.videoTrack.play(`player-${l}`)}a==="audio"&&e.audioTrack.play()}function y(e,a){const l=e.uid;p[l]=e,g(e,a)}function C(e,a){if(a==="video"){const l=e.uid;delete p[l],$(`#player-wrapper-${l}`).remove()}}function w(){for(var e=document.getElementsByName("radios"),a,l=0;l<e.length;l++)e[l].checked&&(a=e[l].value);return a}
